# é—®é¢˜ 1 ï¼šdeplomentå’Œserviceçš„å…³ç³»æ˜¯ä»€ä¹ˆ

![image](https://github.com/zyx8629/-ISTIO/blob/main/images/Question-1.jpeg)

## ä¸¾ä¸ª ðŸŒ° 

![image](https://github.com/zyx8629/-ISTIO/blob/main/images/%E6%88%AA%E5%B1%8F2020-11-24%20%E4%B8%8A%E5%8D%8810.04.03.png)

   å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ©ç”¨ devlopment å‘å¸ƒäº†ä¸€ä¸ªå«åš petclinic çš„åº”ç”¨ï¼Œåœ¨ k8s é›†ç¾¤ä¸­ï¼Œæƒ³è®¿é—®è¿™ä¸ªåº”ç”¨ï¼Œåˆ©ç”¨ pod IPã€container IPã€è™šæ‹Ÿç½‘æ¡¥å°±å¯ä»¥å®žçŽ°ï¼Œä½†æ˜¯è¿™ä¸ªåº”ç”¨æ˜¯éœ€è¦æ”¯æŒå¤–éƒ¨è®¿é—®çš„ï¼Œå› ä¸ºç”¨æˆ·æ˜¯é€šè¿‡å¤–éƒ¨æµè§ˆå™¨è¿›è¡Œè®¿é—®é›†ç¾¤å†…éƒ¨æœåŠ¡çš„ã€‚åŒæ—¶ï¼Œç”±äºŽ devlopment å‘å¸ƒçš„ä¸€ç»„ pods å­˜åœ¨é”€æ¯å†åˆ›å»ºçš„æœºåˆ¶ï¼Œå¯¼è‡´ pods çš„ IP æ˜¯ä¸å›ºå®šçš„ï¼Œåˆå¢žåŠ äº†å¤–éƒ¨è®¿é—®çš„éš¾åº¦ã€‚å› æ­¤ï¼Œéœ€è¦ä¸€ä¸ªå›ºå®šçš„åœ°å€æ¥è¡¨ç¤ºä¸€ç³»åˆ—å¯æä¾›ç›¸åŒæœåŠ¡ pods ï¼Œé‚£ä¹ˆ service å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚å…¶ä¸­ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªå›ºå®šçš„è®¿é—®ç«¯å£ï¼Œç›´æŽ¥æš´éœ²è¿™ç»„çš„æœåŠ¡ï¼Œè¿˜å¯ä»¥è§„å®šè®¿é—®ç±»åž‹ï¼ˆå¦‚ LB CIP NPï¼‰ã€‚è€Œä¸”ï¼ŒService å’Œ pods æ˜¯é€šè¿‡ä¸€ä¸ª Selectorè¿›è¡Œç»‘å®šçš„ï¼Œä¸º Service æŒ‡å®š appï¼špetclinic å³å¯ä¸Ž deploment åˆ›å»ºçš„è¯¥åº”ç”¨ç»‘å®šï¼Œé€šè¿‡æ‰§è¡ŒæŸ¥çœ‹ pod çš„ endpoint ä¹Ÿå¯ä»¥æ£€æŸ¥æ˜¯å¦ç»‘å®šæˆåŠŸã€‚
 
# é—®é¢˜ 2 ï¼šapiversionæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆè¦è®¾ç½®è¿™ä¸ªä¸œè¥¿

![image](https://github.com/zyx8629/-ISTIO/blob/main/images/Question-2.png)

# é—®é¢˜ 3 ï¼šå¦‚ä½•ç†è§£kubernetes operatorè¿™ä¸ªæ¦‚å¿µ

![image](https://github.com/zyx8629/-ISTIO/blob/main/images/Question-3.png)

## ä¸¾ä¸ª ðŸŒ°

![image](https://github.com/zyx8629/-ISTIO/blob/main/images/flagger-canary-overview.png)

   åœ¨å‰é¢å­¦ä¹ è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä½¿ç”¨è¿‡ä¸€ä¸ªå«åš flagger çš„æ¡†æž¶ï¼Œå®žçŽ°äº†ä¸€ä¸‹è‡ªåŠ¨åŒ–é‡‘ä¸é›€å‘å¸ƒã€‚æ•´ä¸ªå®žçŽ°è¿‡ç¨‹å°±æ˜¯é€šè¿‡æ ¹æ®å®˜æ–¹æ ·ä¾‹ï¼Œè‡ªå®šä¹‰åˆ†æžå‚æ•°ã€åº¦é‡æŒ‡æ ‡å†™ä¸€ä¸ª CRD.yaml æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œï¼Œé‚£ä¹ˆ flagger åœ¨è¿™æ¬¡å®žè·µä¸­å°±æ˜¯ä¸€ä¸ª operator ï¼Œå®ƒä¼šè‡ªåŠ¨å¸®æˆ‘ä»Ž Prometheus ä¸­æå– metric æ•°æ®ï¼ŒæŒ‰è®¾å®šçš„å…¬å¼è¿›è¡Œé˜ˆå€¼è®¡ç®—ï¼Œå¦‚æžœè¯¥å€¼è¾¾åˆ°é¢„æœŸçš„è®¾å®šï¼Œå°±æŒ‰æƒé‡è¿›è¡Œé€æ­¥çš„æµé‡å¯¼å…¥ï¼Œå¦‚æžœä¸æˆåŠŸåˆ™è‡ªåŠ¨é€€å›žå°±ç‰ˆæœ¬ã€‚è¿™æ ·çš„è¿‡ç¨‹å°±æ˜¯åŸºäºŽä¸€ä¸ª operator å®žçŽ°ä¸€ä¸ªè‡ªåŠ¨åŒ–æ‰©å±• K8s èµ„æºçš„æ“ä½œã€‚

# é—®é¢˜ 4 ï¼šç”¨ä¸€ä¸ªåœºæ™¯å¯¹istioæµé‡è§„åˆ™çš„å®žçŽ°è¿›è¡Œæè¿° 

![image](https://github.com/zyx8629/-ISTIO/blob/main/images/Question-4.png)

   ç”¨ä»¥ä¸Šè¿™å¼ å›¾çš„åšä¸ºè®²è§£åœºæ™¯ï¼Œistio ç½‘ç»œæ˜¯å»ºç«‹åœ¨ k8s èµ„æºä¹‹ä¸Šçš„ï¼Œä¸€ä¸ªæœ€å¤§çš„ç‰¹å¾å°±æ˜¯ï¼Œistio å¯ä»¥ä¸ºæŒ‡å®šå‘½åç©ºé—´ä¸­çš„ pods æ³¨å…¥ä¸€ç§å«åš â€œsidecarâ€ çš„ä»£ç†ï¼ˆè“è‰²ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†åœ¨åšä»€ä¹ˆï¼Ÿå®ƒä¸»è¦æ˜¯->æ‹¦æˆª<-äº†è¿›å…¥æœåŠ¡çš„å…¨éƒ¨æµé‡ï¼Œç›´æŽ¥æŽ¥ç®¡æœåŠ¡çš„æµé‡ä¸šåŠ¡ï¼Œè®©æœåŠ¡ä»£ç åªä¸“æ³¨äºŽä¸šåŠ¡é€»è¾‘ï¼Œä¸éœ€è¦è¿›è¡Œæµé‡ç®¡ç†ä»»åŠ¡ï¼ˆå¦‚ javaä»£ç ä¸­å¸¸è§çš„â€œ@AæœåŠ¡è°ƒç”¨BæœåŠ¡è‹¥ä¸æˆåŠŸé‡æ–°å°è¯•ä¸‰æ¬¡â€è¿™ç±»ä»£ç ï¼‰ã€‚åœ¨ istio çš„å®žé™…ç»“æž„ä¸­ï¼Œè¿™ä¸ª â€œsidecarâ€ ä¸»è¦æœ‰ä¸¤ä¸ªçº¿ç¨‹ç»„æˆ â€œpilot-agentâ€ (ç»¿è‰²)å’Œ â€œEnvoyâ€ (é»‘è‰²)ã€‚å…¶ä¸­ï¼Œâ€œpilot-agentâ€å¦‚å…¶åæ‰€ç¤ºï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªä»£ç†ï¼Œæ˜¯è´Ÿè´£åŽ»æŽ§åˆ¶é¢çš„ Pilot ä¸­èŽ·å– "Envoy" çš„é™æ€é…ç½®ï¼Œå¹¶è¿›è¡ŒåŠ è½½ã€‚â€œEnvoyâ€ éœ€è¦ç”± â€œpilot-agentâ€ è¿›ç¨‹å¯åŠ¨ï¼Œå¹¶è¯»å– "pilot-agent" ä¸ºå®ƒç”Ÿæˆçš„é…ç½®æ–‡ä»¶ï¼Œç„¶åŽæ ¹æ®è¯¥æ–‡ä»¶çš„é…ç½®èŽ·å–åˆ° Pilot çš„åœ°å€ï¼Œé€šè¿‡ Envoy API çš„ xDS æŽ¥å£ä»Ž Pilot æ‹‰å–åŠ¨æ€é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬è·¯ç”±ï¼ˆRouteï¼‰ï¼Œç›‘å¬å™¨ï¼ˆListenerï¼‰ï¼ŒæœåŠ¡é›†ç¾¤ï¼ˆClusterï¼‰å’ŒæœåŠ¡ç«¯ç‚¹ï¼ˆEndpointï¼‰ã€‚Envoyåˆå§‹åŒ–å®ŒæˆåŽï¼Œå°±æ ¹æ®è¿™äº›é…ç½®ä¿¡æ¯å¯¹æœåŠ¡é—´çš„é€šä¿¡è¿›è¡Œå¯»å€å’Œè·¯ç”±ã€‚
   
## é‚£ä¹ˆåœ¨ istio ç½‘ç»œä¸‹æµé‡æ˜¯å¦‚ä½•åˆ†å‘åˆ°æ¯ä¸ªæœåŠ¡ä¸­çš„å‘¢ï¼Ÿ
   
   ä»Žå¤´è¯´èµ·ï¼Œç”¨kubectlæ‰§è¡Œä¸€ä¸ª istio è·¯ç”±è§„åˆ™ï¼ˆå¦‚ VSï¼‰ï¼Œæ­¤æ—¶ k8s ä¸­çš„ kube-apiserver ä¸º api å¯¹è±¡éªŒè¯å¹¶é…ç½®æ•°æ®ã€‚æŽ§åˆ¶é¢çš„ Pilot å…·æœ‰ list/watch æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ—¶åˆ»åœ¨çœ‹ç€ kube-apiserver æœ‰æ²¡æœ‰å‘å¸ƒè·Ÿ istio ç›¸å…³çš„è§„åˆ™ã€æ–‡ä»¶ã€æŒ‡ä»¤ç­‰ï¼Œå½“å®ƒå‘çŽ°æœ‰ä¸€ä¸ª VS è¢«æ‰§è¡ŒåŽï¼Œå°±å°†è¯¥è§„åˆ™å‘ç»™ â€œpilot-agentâ€ ä»¬ã€‚â€œpilot-agentâ€ åˆåŽ»é€šçŸ¥ â€œEnvoyâ€ å¼€å§‹æ‰§è¡Œå½“å‰è§„åˆ™è¿›è¡Œè·¯ç”±è½¬å‘ï¼Œâ€œEnvoyâ€ å°±ä¼šæŒ‰è§„åˆ™åŠžäº‹å„¿äº†ï¼Œå°†è§„åˆ™ä¸‹çš„æµé‡è½¬å‘ç»™è‡ªå·±çš„æœåŠ¡ï¼ŒåŒæ—¶ï¼ŒæœåŠ¡ä¸­æµå‡ºçš„æµé‡ä¹Ÿä¼šå…ˆæäº¤ç»™ â€œEnvoyâ€ ï¼Œç»å®ƒæ‰‹ï¼Œå†æŒ‰è§„åˆ™è¿›è¡Œä¸‹ä¸€æ¬¡çš„ä¼ é€’ã€‚
   
## é‚£ä¹ˆ åœ¨istio ç½‘ç»œä¸‹ï¼Œä¸åŒ node ä¸Šçš„ pod åˆæ˜¯å¦‚ä½•è¿›è¡Œæµé‡è½¬å‘çš„ï¼Ÿ
  
  å°±åƒå›¾ç‰‡ä¸Šæ‰€ç”»ï¼Œä¸ŠæµæœåŠ¡äº§ç”Ÿçš„æµé‡ä¹Ÿæ˜¯ç”±å®ƒçš„ â€œsidecarâ€ å…ˆæŽ¥æ‰‹ï¼Œä¾æ—§æŒ‰ç…§å½“å‰ç½‘ç»œä¸­çš„è§„åˆ™è¿›è¡Œè½¬å‘ï¼Œå‘ç»™ä¸‹ä¸€ä¸ªæœåŠ¡çš„ â€œsidecarâ€ ï¼Œæœ€ç»ˆæ‰åˆ°è¾¾ä¸‹ä¸€ä¸ªæœåŠ¡ä¸­ã€‚
  
  ðŸŒŸ  å› æ­¤ï¼Œå¸¸è¯´ istio æä¾›äº†æ›´åŠ ç»†ç²’åº¦çš„æµé‡ç®¡ç†ï¼Œå®žçŽ°äº†å¯¹ pod å±‚çº§çš„æµé‡ç®¡ç†ã€‚æˆ‘è¿˜æ‰¾åˆ°è¿™æ ·ä¸€å¼ ç»“æž„å›¾ã€‚
  
  ![image](https://github.com/zyx8629/-ISTIO/blob/main/images/mesh.jpeg)
  
  å°±èƒ½çœ‹å‡ºåœ¨æ‹¥æœ‰ æœåŠ¡ç½‘æ ¼ çš„å‘½åç©ºé—´ä¸‹ï¼Œæ—¢ç„¶å·²ç»å®žçŽ°äº†ä¸€ä¸ªæ›´ç»†è‡´çš„æµé‡ç®¡ç†ï¼Œå°±å·²ç»ä¸å†ä½“çŽ°ä¸Šå±‚æµé‡ä»£ç†ï¼ˆkube-proxyï¼‰çš„ä½œç”¨äº†ï¼Œå°±æ›´ä¸å¤ªä½“çŽ°ä¸åŒ node é—´çš„ podé€šä¿¡äº¤äº’ï¼ˆè™šæ‹Ÿç½‘æ¡¥ï¼‰çš„å¤æ‚äº†ï¼ˆè™½ç„¶ä¸çŸ¥é“è¿™ä¹ˆè¯´å¯¹ä¸å¯¹ï½žï¼‰ï¼Œä¸»è¦è¿˜æ˜¯åœ¨äºŽ â€œEnvoyâ€ çš„å¸®åŠ©ï¼Œé€šè¿‡é…ç½® â€œEnvoy Configâ€ ï¼Œåœ¨å„ä¸ªæœåŠ¡ä¸­è¿›è¡Œè§„åˆ™çš„åŠ¨æ€è½¬å‘ã€‚
  
  
  
 
   
   
